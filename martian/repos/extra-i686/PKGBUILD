# $Id$
# Maintainer:
# Contributor: Steve Vialle <steve_v@orcon.net.nz>

pkgname=martian
pkgver=20061203
pkgrel=13
license=("GPL" "custom:Agere Systems license")
arch=('i686')
_kernver=2.6.25-ARCH
pkgdesc="Alternative drivers for the Mars chipset Lucent LT Winmodem (PCI). For stock kernel26" 
url="http://martian.barrelsoutofbond.org/"
install=martian.install 
source=(http://www.barrelsoutofbond.org/downloads/martian/martian-full-${pkgver}.tar.gz
	kernel-2.6.24.patch
	fastcall.patch)
depends=('kernel26>=2.6.25.3-1' 'kernel26<2.6.26' 'glibc' 'martian-utils')
options=('!strip')
replaces=('ltmodem')
md5sums=('599dcd2441ce996bb466853cb95b9ec9'
         'c32376163dbc453a0488f5f9734f96c4'
         '80d01bef7c0bed9f4fc61fb0e663124b')
                  
build() { 

#Build
  cd $startdir/src/martian
  patch -Np0 -i ../kernel-2.6.24.patch || return 1
  patch -Np1 -i ../fastcall.patch || return 1
  sed -i -e "s#\$(shell uname -r)#$_kernver#g" $startdir/src/martian/kmodule/Makefile
  cd $startdir/src/martian && make KERNEL_DIR=/usr/src/linux-${_kernver} all || return 1 
  #Install kernel modules
  install -D -m 644 $startdir/src/martian/kmodule/martian_dev.ko $startdir/pkg/lib/modules/${_kernver}/kernel/drivers/net/martian_dev.ko
}  
