# $Id$
# Maintainer: judd <jvinet@zeroflux.org>
pkgname=dhcp
pkgver=4.1.0
pkgrel=1
pkgdesc="A DHCP server, client, and relay agent"
arch=(i686 x86_64)
license=('custom:isc-dhcp')
url="http://www.isc.org/sw/dhcp/"
depends=('openssl>=0.9.8a')
backup=('etc/dhcpd.conf' 'etc/dhclient.conf')
install=dhcp.install
source=(http://ftp.isc.org/isc/dhcp/dhcp-${pkgver}.tar.gz dhcp-3.0.3-tr.c.patch
dhcpd)
md5sums=('1fffed2e8c3d67b111316d6a9b33db7a' '39866416303b674df08b66b2d094e523'
         '025b8fe98b6c0814428b671b1819a810')

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  patch -p1 -i ../dhcp-3.0.3-tr.c.patch || return 1
  # Define _GNU_SOURCE to fix IPV6.
  sed '/^CFLAGS="$CFLAGS/ s/INGS"/INGS -D_GNU_SOURCE"/' -i configure
  ./configure --prefix=/usr --sysconfdir=/etc \
      --with-srv-lease-file=/var/state/dhcp/dhcpd.leases \
      --with-srv6-lease-file=/var/state/dhcp/dhcpd6.leases
  make || return 1
  make DESTDIR=${pkgdir} install

  #install -D -m644 server/dhcpd.conf ${pkgdir}/etc/dhcpd.conf
  #install -D -m644 client/dhclient.conf ${pkgdir}/etc/dhclient.conf
  install -D -m755 ${srcdir}/dhcpd ${pkgdir}/etc/rc.d/dhcpd
  mkdir -p ${pkgdir}/var/state/dhcp
  #touch ${pkgdir}/var/state/dhcp/dhcpd.leases
  #chmod -R 644 ${pkgdir}/usr/share/man/*
  #chmod 755 ${pkgdir}/usr/share/man/man{1,3,5,8}
  #sed -i 's|etc/dhclient-script|sbin/dhclient-script|g' \
  #${pkgdir}/etc/dhclient.conf
  #rm -f ${pkgdir}/var/state/dhcp/dhcpd.leases
  #rm -f ${pkgdir}/sbin/{dhclient,dhclient-script}
  rm -f ${pkgdir}/etc/dhclient.conf
  rm -f ${pkgdir}/usr/sbin/dhclient
  rm -f ${pkgdir}/usr/share/man/man{5,8}/dhclient*
  # install licenses
  install -m644 -D ${srcdir}/${pkgname}-${pkgver}/LICENSE \
                   ${pkgdir}/usr/share/licenses/dhcp/LICENSE
}
