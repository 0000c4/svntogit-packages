# $Id$
# Maintainer: Jan "heftig" Steffens <jan.steffens@gmail.com>
# Contributor: Ionut Biru <ibiru@archlinux.org>
# Contributor: Hugo Doria <hugo@archlinux.org>

pkgname=deluge
pkgver=1.3.3
pkgrel=5
pkgdesc="A BitTorrent client with multiple user interfaces in a client/server model"
arch=('any')
url="http://deluge-torrent.org/"
license=('GPL3')
depends=('pyxdg' 'libtorrent-rasterbar>=0.15.0' 'twisted' 'python2-pyopenssl'
         'xdg-utils' 'python2-chardet' 'desktop-file-utils' 'hicolor-icon-theme'
         'python2-distribute')
makedepends=('intltool' 'pygtk' 'librsvg' 'python2-mako')
optdepends=('python-notify: libnotify notifications'
            'pygtk: needed for gtk ui'
            'librsvg: needed for gtk ui'
            'python2-mako: needed for web ui')
backup=(etc/conf.d/deluged)
install=deluge.install
source=(http://download.deluge-torrent.org/source/$pkgname-$pkgver.tar.bz2
        deluged deluged.conf.d deluge-web)
md5sums=('4027c60bb5d1c5da61e97a47e62ab1ab'
         '7d5790eeb14cd0b47d1bb3e0a19c9935'
         '332d23fe0d21ce92b494efd73322856c'
         '6c913ec7322eaa60494ac9d53103005f')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  python2 setup.py build
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  python2 setup.py install --prefix=/usr --root="$pkgdir" --optimize=1
  install -Dm644 deluge/data/pixmaps/deluge.svg "$pkgdir/usr/share/pixmaps/deluge.svg"

  _dir="$pkgdir/usr/lib/python2.7/site-packages/deluge/ui"
  sed -e '1s/python$/&2/' \
      -i "$_dir/Win32IconImagePlugin.py" \
      -i "$_dir/web/gen_gettext.py"

  install -d "$pkgdir/srv/deluge"
  install -D "$srcdir/deluged" "$pkgdir/etc/rc.d/deluged"
  install -D "$srcdir/deluge-web" "$pkgdir/etc/rc.d/deluge-web"
  install -Dm644 "$srcdir/deluged.conf.d" "$pkgdir/etc/conf.d/deluged"
}
