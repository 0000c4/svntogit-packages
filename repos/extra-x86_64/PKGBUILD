# $Id$
# Maintainer: Alexander Baldeck <alexander@archlinux.org>
# Maintainer: Jan de Groot <jgc@archlinux.org>
pkgname=xf86-video-intel
pkgver=2.4.2
pkgrel=2
pkgdesc="X.org Intel i810/i830/i915/945G/G965+ video drivers"
arch=(i686 x86_64)
url="http://xorg.freedesktop.org/"
depends=('intel-dri>=7.2' 'libpciaccess>=0.10.5' 'libdrm>=2.3.1')
makedepends=('pkgconfig' 'xorg-server>=1.5.3' 'xf86driproto>=2.0.4' 'glproto>=1.4.9' 'mesa>=7.2' 'libdrm=2.3.1')
conflicts=('xorg-server<1.5.3' 'xf86-video-i810')
replaces=('xf86-video-i810')
options=('!libtool' 'force')
groups=('xorg-video-drivers')
source=(${url}/releases/individual/driver/${pkgname}-${pkgver}.tar.bz2
	20_thinkpad_g40_quirk.patch
	21_quirk_lenovo.patch
	22_no_pipe_for_hotplug_detection.patch
	23_quirks_studiohybrid_eeepc_and_w251u.patch
	25_quirk_nc6110.patch
	26_i830-use-lfp-data-ptrs.patch
	27_disable_fbc_on_965.patch
	28_stolen_memory_counting_g4x.patch)
md5sums=('462f205bd47766265246cc39801b75e7')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  patch -Np1 -i "${srcdir}/20_thinkpad_g40_quirk.patch" || return 1
  patch -Np1 -i "${srcdir}/21_quirk_lenovo.patch" || return 1
  patch -Np1 -i "${srcdir}/22_no_pipe_for_hotplug_detection.patch" || return 1
  patch -Np1 -i "${srcdir}/23_quirks_studiohybrid_eeepc_and_w251u.patch" || return 1
  patch -Np1 -i "${srcdir}/25_quirk_nc6110.patch" || return 1
  patch -Np1 -i "${srcdir}/26_i830-use-lfp-data-ptrs.patch" || return 1
  patch -Np1 -i "${srcdir}/27_disable_fbc_on_965.patch" || return 1
  patch -Np1 -i "${srcdir}/28_stolen_memory_counting_g4x.patch" || return 1
  ./configure --prefix=/usr \
              --enable-dri || return 1
  make || return 1
  make DESTDIR="${pkgdir}" install || return 1
}
