# $Id$
# Maintainer: Eric Belanger <eric@archlinux.org>

pkgname=device-mapper
pkgver=1.02.29
_lvmver=2.02.43
pkgrel=1
pkgdesc="Device mapper userspace library and tools."
arch=('i686' 'x86_64')
url="http://sourceware.org/dm/"
license=('GPL')
groups=('base')
depends=('glibc')
source=(ftp://sources.redhat.com/pub/lvm2/LVM2.${_lvmver}.tgz device-mapper.rules)
md5sums=('fc34655706a2aa116b92328b24fad619' '065f32a36947e6183722ed9aef13dc0c')
sha1sums=('28a1f553f53fa568e85b41879bb32d1c11fdd07d' '003f5cf654503dcc9c1ba7c11c7d6e77bf27bb8d')

build() {
  cd ${srcdir}/LVM2.${_lvmver}
  ./configure --prefix=/usr || return 1
  make device-mapper || return 1
  make DESTDIR=${pkgdir} sbindir=${pkgdir}/sbin \
    libdir=${pkgdir}/lib install_device-mapper || return 1

  # install the static library as well
  install -D -m644 libdm/ioctl/libdevmapper.a ${pkgdir}/usr/lib/libdevmapper.a || return 1
  # install udev rule
  install -D -m644 ${srcdir}/device-mapper.rules ${pkgdir}/etc/udev/rules.d/device-mapper.rules || return 1
  # fix device-mapper link bug
  ln -sf /lib/libdevmapper.so ${pkgdir}/usr/lib/libdevmapper.so || return 1
}
