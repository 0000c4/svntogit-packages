 src/plugins/git/daemon/ipc-git-repository-impl.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git c/src/plugins/git/daemon/ipc-git-repository-impl.c i/src/plugins/git/daemon/ipc-git-repository-impl.c
index 7f010427a..c5028658d 100644
--- c/src/plugins/git/daemon/ipc-git-repository-impl.c
+++ i/src/plugins/git/daemon/ipc-git-repository-impl.c
@@ -33,7 +33,7 @@
 #include "ipc-git-types.h"
 #include "ipc-git-util.h"
 
-#if LIBGIT2_SOVERSION >= 28
+#if LIBGIT2_VER_MAJOR > 0 || (LIBGIT2_VER_MAJOR == 0 && LIBGIT2_VER_MINOR >= 28)
 G_DEFINE_AUTO_CLEANUP_CLEAR_FUNC (git_buf, git_buf_dispose)
 #else
 G_DEFINE_AUTO_CLEANUP_CLEAR_FUNC (git_buf, git_buf_free)
