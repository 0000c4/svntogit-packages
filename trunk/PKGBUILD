# $Id$
# Maintainer: Jan de Groot <jgc@archlinux.org>
# Contributor: Alexander Baldeck <alexander@archlinux.org>

pkgname=xf86-video-ati
_gitdate=20091207
pkgver=6.12.99.git${_gitdate} # see configure.ac
#pkgver=6.12.4
pkgrel=1
pkgdesc="X.org ati video driver"
arch=(i686 x86_64)
url="http://xorg.freedesktop.org/"
license=('custom')
depends=('libdrm>=2.4.16' 'libpciaccess' 'ati-dri>=7.6' 'pixman>=0.16.2')
makedepends=('pkgconfig' 'xorg-server>=1.7.0' 'fontsproto'
	     'glproto>=1.4.10' 'xf86driproto' 'diffutils' 'xorg-util-macros' 'xineramaproto' 'mesa>=7.6')
conflicts=('xorg-server<1.7.0')
groups=('xorg-video-drivers')
options=('!libtool')
source=( # ${url}/releases/individual/driver/${pkgname}-${pkgver}.tar.bz2
	ftp://ftp.archlinux.org/other/$pkgname/xf86-video-ati-${_gitdate}.tar.bz2
	LICENSE)
md5sums=('72705fd52ce3391a33dabd8e4b321440'
         '75da66945980a43adf1e1856271b9d4a')

build() {
  # get git code
#  cd ${srcdir}
#  git clone -v git://anongit.freedesktop.org/xorg/driver/xf86-video-ati
#  cd xf86-video-ati
#  git archive --prefix=xf86-video-ati-${_gitdate}/ --format=tar HEAD | bzip2 > ../../xf86-video-ati-${_gitdate}.tar.bz2
#  return 1

#  cd "${srcdir}/${pkgname}-${pkgver}"
  cd "${srcdir}/${pkgname}"*
  ./autogen.sh --prefix=/usr --enable-dri || return 1
#  ./configure --prefix=/usr --enable-dri || return 1
  make || return 1
  make "DESTDIR=${pkgdir}" install || return 1
  install -D -m644 "${srcdir}/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
