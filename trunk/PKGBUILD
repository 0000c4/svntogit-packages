# $Id$
# Maintainer: Aaron Griffin <aaron@archlinux.org>
# Contributor: Judd Vinet <jvinet@zeroflux.org>

pkgname=logrotate
pkgver=3.7.7
pkgrel=2
pkgdesc="Rotates system logs automatically"
url='http://cvs.fedora.redhat.com'
arch=(i686 x86_64)
license=('GPL')
groups=('base')
depends=('popt' 'cron' 'gzip')
backup=('etc/logrotate.conf')
#WTF are you doing, Fedora?
_pkgmd5=431e135abb7f3fe19de4c6a65bb66823
source=( http://cvs.fedora.redhat.com/repo/pkgs/$pkgname/$pkgname-$pkgver.tar.gz/$_pkgmd5/$pkgname-$pkgver.tar.gz
        logrotate.conf logrotate.cron.daily)
md5sums=($_pkgmd5
         'c8b915903825befc401797b7620f249e'
         '8e23d5d4cc29b1e055b24df87e355cdc')

build() {
  cd $startdir/src/${pkgname}-${pkgver}

  sed -i 's|#define DEFAULT_MAIL_COMMAND .*|#define DEFAULT_MAIL_COMMAND "/usr/bin/mail"|'\
    config.h
  sed -i "s|CFLAGS = -Wall|CFLAGS = -Wall $CFLAGS" Makefile
  make || return 1
  make PREFIX=$pkgdir install
  install -D -m644 ../logrotate.conf $pkgdir/etc/logrotate.conf
  install -D -m744 ../logrotate.cron.daily $pkgdir/etc/cron.daily/logrotate

  mkdir -p $pkgdir/usr/share/
  mv $pkgdir/usr/man $pkgdir/usr/share
}
