# $Id$
# Maintainer: damir <damir@archlinux.org>

pkgname=avidemux
pkgver=2.4.1
origver=$pkgver
pkgrel=2
pkgdesc="A graphical tool to edit video (filter/re-encode/split)"
arch=("i686" "x86_64")
license=('GPL2')
url="http://fixounet.free.fr/avidemux/"
depends=('libxv' 'libvorbis' 'libxml2' 'gtk2>=2.10' 'alsa-lib' 'lame' 'xvidcore' 'faad2' 'faac' 'sdl' 'x264>=20080625')

# neededpatchesuris=(http://download.berlios.de/avidemux/2.0.38_eq2_patch.diff)
# neededpatches=(2.0.38_eq2_patch.diff)

#source=(http://fixounet.free.fr/avidemux/$pkgname-$pkgver.tar.gz)
options=('!makeflags')
source=("http://download.berlios.de/avidemux/${pkgname}_$origver.tar.gz" \
        $neededpatchesuris \
        avidemux-2.4.1-gcc43-includes.patch \
        avidemux-2.4.1-gcc43-missing-asm-naming.patch \
        "avidemux.desktop")
md5sums=('2d972f6b8795c891dd6e0ebe5035852a'
         '47ba1d4c5f591d2d820f3ae8089e8484'
         '7effafa9f6827c05be2df8f027d8e77f'
         'a9cf864c209782307afda5bc6a33a0cd')

build() {
  cd $startdir/src/${pkgname}_$origver

  patch -p1 < ../avidemux-2.4.1-gcc43-includes.patch || return 1
  patch -p1 < ../avidemux-2.4.1-gcc43-missing-asm-naming.patch || return 1
  # apply patches if needed:
    if [ -n "$neededpatches" ]    # $neededpatches is not NULL
    then
    for i in $neededpatches; do
        cat $startdir/src/$i | patch -d $pkgname -p0 || return 1
    done
    fi

  # the author uses an older version of automake:
  #autoreconf --force || return 1
  make -f Makefile.dist || return 1

  # finally, we can start building:
  ./configure --prefix=/usr \
	      --without-arts --without-esd
  make || return 1
  make prefix=$startdir/pkg/usr install || return 1

  # freedesktop thingies
  install -Dm644 avidemux_icon.png ${startdir}/pkg/usr/share/pixmaps/avidemux.png
  install -Dm644 $startdir/src/$pkgname.desktop $startdir/pkg/usr/share/applications/avidemux.desktop

}
