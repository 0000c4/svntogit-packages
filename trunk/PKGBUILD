# $Id: PKGBUILD 262050 2016-03-18 18:02:01Z andyrtr $
# Maintainer: Andreas Radke <andyrtr@archlinux.org>

# Contributor: Chris Severance aur.severach aATt spamgourmet dott com
# Contributor: Andreas B. Wagner <AndreasBWagner@pointfree.net>
# Contributor: Suat SARIALP <muhendis.suat@gmail.com>

pkgname=docbook-utils
pkgver=0.6.14
pkgrel=6
pkgdesc='Shell scripts to manage DocBook documents'
#arch=('i686' 'x86_64')
arch=('any')
url="https://fedorahosted.org/docbook-utils/"
license=('GPL2')
#depends=('docbook-sgml31' 'docbook-dsssl' 'jade' 'docbook-xml-dtd' 'perl-sgmls' 'lynx' 'opensp')
#depends=('openjade' 'docbook-dsssl') # 'lynx') # 'docbook-sgml')
depends=('openjade' 'docbook-dsssl' 'perl-sgmls') # 'perl')
#conflicts=('docbook2x')
source=(ftp://sources.redhat.com/pub/docbook-tools/new-trials/SOURCES/${pkgname}-${pkgver}.tar.gz
#'html.tar.gz' 
        docbook-utils-0.6.14-grep_fix-1.patch
        docbook-utils-0.6.14-fix-bashisms.patch
        docbook-utils-catalog-jw.patch
)
#sha256sums=('48faab8ee8a7605c9342fb7b906e0815e3cee84a489182af38e8f7c0df2e92e9'
#            'ddf0ddca0a540fd4f34f38b7b9090f96746e37da12b4e2bf8f4174c5ad61f54a')
md5sums=('6b41b18c365c01f225bc417cf632d81c'
         '9acefe856adfb13f0efabb68c8c6c745'
         'fc993634516e46ed221356bc0609a92c'
         '850281401469a6c41d6fb514a044a47a')

prepare() {
  cd "${pkgname}-${pkgver}"
  patch -Np1 -i ${srcdir}/docbook-utils-0.6.14-grep_fix-1.patch
#  sed -i 's:/html::' doc/HTML/Makefile.*
  #sed -i 's:/html::' doc/Makefile.*
#  patch -Np1 -i ${srcdir}/docbook-utils-0.6.14-fix-bashisms.patch
#  patch -Np1 -i ${srcdir}/docbook-utils-catalog-jw.patch
#  autoreconf -vfi
}

build() {
  cd "${pkgname}-${pkgver}"
  ./configure --prefix=/usr \
    --sysconfdir=/etc \
    --mandir=/usr/share/man
  make  
#return 1
#  cp -p "${srcdir}/html"/* 'doc/HTML'
}

package() {
  cd "${pkgname}-${pkgver}"
  make install DESTDIR="${pkgdir}" prefix=/usr mandir='/usr/share/man' htmldir="/usr/share/doc/${pkgname}/html" docdir=/tmp

  #common alternative names
  local doctype
  for doctype in 'html' 'ps' 'dvi' 'man' 'pdf' 'rtf' 'tex' 'texi' 'txt'; do
    ln -svf "docbook2${doctype}" "${pkgdir}/usr/bin/db2${doctype}"
  done

}
