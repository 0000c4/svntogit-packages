# $Id: PKGBUILD 259288 2016-02-14 08:43:40Z andyrtr $
# Maintainer: Andreas Radke <andyrtr@archlinux.org>

pkgbase="foomatic"
pkgname=('foomatic-db' 'foomatic-db-ppds') # 'foomatic-db-nonfree')
arch=('any')
pkgver=20160214
pkgrel=1
epoch=3

makedepends=('cups' 'perl' 'libxml2' 'enscript' 'perl' 'net-snmp' 'bash' 'bzr')
url="http://www.linuxprinting.org/foomatic.html"
options=('!emptydirs')

# check http://bzr.linuxfoundation.org/loggerhead/openprinting/foomatic/
# for latest commits and development, identical to foomatic-4.0 branch

source=(foomatic-db::bzr+http://bzr.linuxfoundation.org/openprinting/foomatic/foomatic-db/#revision=1295                    #2016-02-04
        #foomatic-db-nonfree::bzr+http://bzr.linuxfoundation.org/openprinting/foomatic/foomatic-db-nonfree/#revision=41      #2015-06-05
)
md5sums=('SKIP')
#         'SKIP')

pkgver() {
  date +%Y%m%d
}

build() {
  # foomatic-db
  cd ${srcdir}/foomatic-db
   bzr revno
   echo $pkgver
   ./make_configure
   ./configure --prefix=/usr
  
  # foomatic-db-nonfree
  
}

package_foomatic-db() {

 pkgdesc="Foomatic - The collected knowledge about printers, drivers, and driver options in XML files, used by foomatic-db-engine to generate PPD files."
 license=('GPL' 'custom')
 depends=('perl' 'libxml2')
 replaces=('foomatic-db-ppd' 'foomatic-db-hpijs')
 conflicts=('foomatic-db-ppd' 'foomatic-db-hpijs')
 provides=('foomatic-db-hpijs')

   cd ${srcdir}/${pkgname}
   bzr revno
   echo $pkgver
#   ./make_configure
#   ./configure --prefix=/usr

make -qp | awk -F':' '/^[a-zA-Z0-9][^$#\/\t=]*:([^=]|$)/ {split($1,A,/ /);for(i in A)print A[i]}' | grep ^install
return 1
   make DESTDIR=${pkgdir} install
   install -v -Dm644 ${srcdir}/${pkgname}/COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
   
   # remove unwanted file that breaks adding printers
   rm ${pkgdir}/usr/share/foomatic/db/source/PPD/Kyocera/ReadMe.htm
}

#package_foomatic-db-nonfree() {
#
# pkgdesc="Foomatic - database extension consisting of manufacturer-supplied PPD files released under non-free licenses"
# license=('custom')
# depends=('perl' 'libxml2' "foomatic-db-engine" 'foomatic-db')

#   cd ${srcdir}/foomatic-db-nonfree
#   bzr revno
#   ./make_configure
#   ./configure --prefix=/usr
#   make DESTDIR=${pkgdir} install
#   install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
#}
