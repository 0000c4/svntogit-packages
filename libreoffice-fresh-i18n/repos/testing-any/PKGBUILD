# $Id$
# Maintainer: Andreas Radke <andyrtr@archlinux.org>
# Maintainer: Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>

pkgbase=libreoffice-fresh-i18n

pkgver=5.1.1
pkgrel=1
_rcver=${pkgver}.3
#_oodlver=${pkgver}.0.beta1
_oodlver=${pkgver}

arch=('any')
url="http://www.documentfoundation.org"
license=('LGPL')
makedepends=('rpmextract')

#http://download.documentfoundation.org/mirrors/all.html
_url="http://download.documentfoundation.org/libreoffice/stable"
#_url="http://download.documentfoundation.org/libreoffice/testing"
#_url="http://dev-builds.libreoffice.org/pre-releases"
#_url="http://www.libreoffice.org/download/pre-releases"

#_url+="/${pkgver}-rc2/rpm/x86"
_url+="/${pkgver}/rpm/x86"
#_url+="/rpm/x86"

_languages=(
  'af            "Afrikaans"'
  'am            "Amharic"'
  'ar            "Arabic"'
  'as            "Assamese (India)"'
  'ast           "Asturianu"'
  'be            "Belarusian"'
  'bg            "Bulgarian"'
  'bn            "Bengali"'
  'bn-IN         "Bengali (India)"'
  'bo            "Tibetan"'
  'br            "Breton"'
  'brx           "Bodo"'
  'bs            "Bosnian"'
  'ca            "Catalan"'
  'ca-valencia   "Catalan (Valencia)"'
  'cs            "Czech"'
  'cy            "Welsh"'
  'da            "Danish"'
  'de            "German"'
  'dgo           "Dogri"'
  'dz            "Dzongkha"'
  'el            "Greek"'
  'en-GB         "English (GB)"'
  'en-ZA         "English (ZA)"'
  'eo            "Esperanto"'
  'es            "Spanish"'
  'et            "Estonian"'
  'eu            "Basque"'
  'fa            "Persian"'
  'fi            "Finnish"'
  'fr            "French"'
  'ga            "Irish"'
  'gd            "Gaelic (Scottish)"'
  'gl            "Galician"'
  'gu            "Gujarati"'
  'he            "Hebrew"'
  'hi            "Hindi"'
  'hr            "Croatian"'
  'hu            "Hungarian"'
  'id            "Indonesian"'
  'is            "Icelandic"'
  'it            "Italian"'
  'ja            "Japanese"'
  'ka            "Georgian"'
  'kk            "Kazakh"'
  'km            "Khmer (Cambodia)"'
  'kmr-Latn      "Kurdish"'
  'kn            "Kannada"'
  'ko            "Korean"'
  'kok           "Konkani"'
  'ks            "Kashmiri"'
  'lb            "Luxembourgish"'
  'lo            "Lao"'
  'lt            "Lithuanian"'
  'lv            "Latvian"'
  'mai           "Maithili"'
  'mk            "Macedonian"'
  'ml            "Malayalam"'
  'mn            "Mongolian"'
  'mni           "Manipuri"'
  'mr            "Marathi"'
  'my            "Burmese"'
  'nb            "Norwegian Bokmal"'
  'ne            "Nepali"'
  'nl            "Dutch"'
  'nn            "Norwegian Nynorsk"'
  'nr            "Ndebele (South)"'
  'nso           "Northern Sotho"'
  'oc            "Occitan"'
  'om            "Oromo"'
  'or            "Oriya"'
  'pa-IN         "Punjabi (India)"'
  'pl            "Polish"'
  'pt            "Portuguese"'
  'pt-BR         "Portuguese (Brasil)"'
  'ro            "Romanian"'
  'ru            "Russian"'
  'rw            "Kinyarwanda"'
  'sa-IN         "Sanskrit (India)"'
  'sat           "Santali"'
  'sd            "Sindhi"'
  'si            "Singhalese"'
  'sid           "Sidama"'
  'sk            "Slovak"'
  'sl            "Slovenian"'
  'sq            "Albanien"'
  'sr            "Serbian"'
  'sr-Latn       "Serbian (Latin)"'
  'ss            "Swati"'
  'st            "Southern Sotho"'
  'sv            "Swedish"'
  'sw-TZ         "Swahili (Tanzania)"'
  'ta            "Tamil"'
  'te            "Telugu"'
  'tg            "Tajik"'
  'th            "Thai"'
  'tn            "Tswana"'
  'tr            "Turkish"'
  'ts            "Tsonga"'
  'tt            "Tatar"'
  'ug            "Uighur"'
  'uk            "Ukrainian"'
  'uz            "Uzbek"'
  've            "Venda"'
  'vi            "Vietnamese"'
  'xh            "Xhosa"'
  'zh-CN         "Chinese (simplified)"'
  'zh-TW         "Chinese (traditional)"'
  'zu            "Zulu"'
)
md5sums=('151019fb8f506199511b29c6b3521bf8'
         'f3009dd7842fb7c44123fd1f91eab802'
         '8332117fa86be724194855a46f3bad8d'
         'ccea7b0942cec56ffce1237dcd8b05f0'
         '0b9a99b64bb462e6b5917a2eca848f47'
         '002e2d99e4b95dd074c6a318156ebab6'
         'fd69e76699c92b98c0fbdef16abfa26f'
         'a2d83c417ada7080364767591ae7f517'
         '00466ef21db6008df0c5dd983fe3fe69'
         '5afd9681d4e15c182a37b876b8e06a56'
         '83546903ddcdadc32eb4f79b30d147a6'
         '499d735ec9896d19e5af8c8480d7b5db'
         '1266691b9177fde3f299c6ec783d774d'
         '6c1e271fa7ad257a7acc5d15e0f81bc0'
         '591193b013a3892a5d909d952ed88cf4'
         '85e60fc6c3e7e0c3a968b08395aaeba0'
         '8ccfd2d3fd8d62eaf313635051b7d8e0'
         '4942364b1197e0e43c8b3242c4b7c14c'
         '3bc89e9253a297499c25cba1e3fdc33c'
         'cf218765e3a61b960ed6e68b13796471'
         'dd4288d811d09b534aadce98938aef5c'
         '099fb4610e41fb917cdb6ff5aa816589'
         '2ded3269bc229c4cbf12f5e5bad6410e'
         'cfc6f1571f05d93a74b81572ca3fa7bf'
         '86826b02a4c7b01762769a516c52aaa6'
         'a5f7030ffe428358ddea259b7333e17f'
         'f19c2b520ab26a55a5640fd091e8776a'
         '469a16ff6a73da80a9759e903d0812d5'
         '7a642ea76443a158c3b5277ac4d326e4'
         '75531448ca45320ea9df5dfca4202adc'
         'f1a109ec6c9bcc6bff00527d77cab8db'
         'cc41664c1424f3c9767c99e6c2dd59de'
         '1a6d01821d0aad4c0cb3125f575b12c2'
         'c9abff6016f49ca06d05ea75ff610edf'
         '6c5305c8b6d747c24880b374cab92d69'
         'cd9c5c51c67cad947e368ab08a6d6ed4'
         '761db0886f6d4c37abefdb51ee1fae6a'
         '493c3fb3dcf97c4a88392d29fa88c744'
         'b4ccb3c1337e19e7e65bba556b6e4b45'
         'fc4e887aeb283f640c7216a72491f2bc'
         '08c96a4787417f26d8a54ef57e3dd78d'
         'cf4d51bfcac3dfccc189a17bced978af'
         '4088ca51e71664e766824254f84e754a'
         '00ef425c3f67d327be571f349e41b102'
         '534dd1983b36e12cb0e93eca264dbcc5'
         '10613f94303ad9c2da5b6458b8516d55'
         'b99cdc42ca2dcd282ff1dbb68150e804'
         '11ceb0e5a84a49d60cb77e577486aadf'
         'e1f4603e6a0fd707c6ec0d285f6223f6'
         '2047e67e6236633b23ab6bddca84c246'
         'c08f312c413d393c23cab6e1513146b2'
         '7ed4cf02e498dd7b6dccce575e402659'
         '7cbd706df57e3d41e04e79798d9d24de'
         '3b77be6173cc258ff08a52f05e466aaa'
         'd57b0acefce598edb317afe13a2b1063'
         '53999a54d4ea21aadd9feda4893c1167'
         '6e4c54917e2cf1fd7f0028deb063e6cf'
         '896ce5dafe42b0f0e96cd4a55349ec8b'
         '52786bb80a2470a4002b94d27cf25eeb'
         '4e958184ac9cf828a486dfc74dc40b7f'
         '916ec4cab76518cf630bfb02d51aca1a'
         '424e7ae901060a842235c56094865781'
         'bdb2e7ed6b211a547910e905a12b64e1'
         '2b9e302912175c42753aff6927fdd0d5'
         '85e743fdea84aafce6f46fa4bc3b9c65'
         '388a6d6b511e84bdff612e23a25364d5'
         'ac2351cb93e84c6f7995fbbdfaf34bb7'
         '48455add21f75b10a1ab514210e2f625'
         '22d28e467342c242cfdcbad464a301ea'
         '9c687fdc8d70598397afc51556da8be1'
         '01e84e7180985eba1eb34ded6564cd97'
         '2302c5bb111e48cb2cea1799af714e47'
         '3d39952ecb3b45821684b22d5dc3424a'
         'f202dd70e64cb83a6224a78eaa25070b'
         'caebeb13b5313d757f11c037800a402c'
         'd42c2c466b755b093bb6761ed670b835'
         'a117266e7ef679a2e37bbfb3e36a699c'
         '294ef28b2524505d23de69be217d04b8'
         'd468c1c7d9cce5856129f7c8ae6225b8'
         '2edf910a38f919539344147154a588ab'
         '378992110a1fffd142f75bb2c5c39b68'
         'a537914cc2604c470d5b0a5aed57a629'
         'ffca221e87d1102b5189014af8e25cb1'
         '8c6a6ff2f3926178e01de9e661a8442b'
         '2aedcdcc3ae3154bc9f500a05c78a3c5'
         '0d2ddc4b521218d4e3d77afa236281a7'
         '76f8b920c7f6c1a57118533e77b3c5ac'
         '2a14ae1674b59f12846a8b82f75f0a41'
         'd412b208188ad6ed03049e40d00bf578'
         '54fb851747d2b79e52abdaeba0559c3c'
         'c5bd2bb8542cde777ab0eb03acd9d7dc'
         'ed782914730c96658dcfcdb85657cada'
         'a313690477185bb2bb883e8589553c87'
         '16662633f5e50073124b0675c5f7967f'
         '647d50a169fca20f7f62ecba0c601e2a'
         '0e8de0854bc9d117835374517695b623'
         '70c6ae03efa6bf16a3741fd77917ec98'
         'ef06d3c777806406af275a92bcb91695'
         '2e223aadaa5d9b10dde613a6086710ee'
         '6fb8c140bb75aa70d93b4972f07db50a'
         'fe211a3264df1e386caefa798763b928'
         '1920ada838912cc122875111e69e03f2'
         '70461ac04c2ad41bd13388e07311422e'
         '749f3d862f6176d7d58b8d1bfd0d7a00'
         'd51228eeab523f2b45143ff82074e397'
         'b3e393d7374cb5d961dc3b8576170794'
         '60a7c1f8ca95eebbca40d47b2a49f06d'
         'ddad2783d55a43cb9cc5df031b91d901'
         '2068333f826d18d49144a59bb5826827'
         '06dd8030b3faa37e81683a8ef6ca107d'
         'fa801fbb116f4deed053b013fe94f202'
         '2c80fb35cadd33b1a796ee62b0acbf1c'
         '9ed58751411d81010a4d98bfd6aa642a'
         '39e1fbd9842899d4da27112f4b72704a'
         '6930c1ea999406e7149beb9f2f751689'
         'fabb025abcbc89b72140c7b9ec266817'
         '7afab1c51752d49ff0d975ef9a3e7fd9'
         '4cc9cb59e7d86c6e6a5c91da5cfaec0f'
         '5a6e094b5f3906f68c73cf25f63d9523'
         'f1e3775874996488176b62311c75861f'
         'bd259327ef486ee601397f9943b4e31c'
         'ad746bc86d7cfda16beb8b798ffa28af'
         '210b7cf2a211243ab24f0c2b16f80e53'
         'd1a9068a75d1fdd927f72e08209a0574'
         'aab44dc9a8aadd0dbc00561f4c95c96d'
         '583dc4033db430a4d24559e3f8ca2834'
         '8ae02886f0c9c6b478d5f905c786b2b7'
         '9ab2c7bb93a129c40be19a59c4acb40a'
         '454a84f62ce05d79fdced79da17d5158'
         '5841f968ca6292f9569f7f5dcbe5edca'
         'c1118b6dc2e9c9bdbdc336bf97f7f5eb'
         '190bce01c71da2d7a0a0d8bdc9346890'
         'b69541ca5f246c602768a0f992d68f91'
         '9d5e17d709ae0b1e82fa6c7813c70fbc'
         '4ae02a746f4c458e78cdc568fad304ca'
         'c8e855dc3ac075b5438a952cb00971ea'
         'c8d107b3b293157aacbc3e36b036bd85'
         '5b9e6594d704f670a5e357c51be29b77'
         '1b5c76c5dbfccc64f23a733e7bfdf6dd'
         '932cdd2a5ccb1e565459354d0637af9c'
         'e278983c7ce059dfee1aa3b7f71d1fcb'
         'b196d24ba657ce02536862e2d79bac97'
         '0ed4ec80c78429ecaab437bea4acf03e'
         '2b39efa5d88d644a89f636da8f168465'
         '68e04ce50cd5fcd887d5a4e67abc954b'
         'ad4dd0677b57f9ff4c8a461475f036fe'
         '96c7b0c6d8feca5d830462898a2784ea'
         '413a35d147d97560396d86d1201c92df'
         'a23f31907b8397f115516ca7622c64b5'
         '32bfa29dcf97baf421f4f9b3f72fb409'
         'b8297fde1817833ed24c160f4b78f262'
         '230fc397073a9862604060772f87a034'
         '9b034a56c7977a3419e67bcb95443956'
         '3a3a9eda20ac7fda6ac8dfaa64873b80'
         '5b0738a4c111247323e80c8a4b6b44cb'
         '2fffc90b9f8cd2850c95b5d74685bd06'
         'ca83301e81ae309930eb2d98bff34ad2'
         '56f866a408acb5358a5c60f868afbf20'
         '37cb01a849e56b0e676eabb135b450fe'
         '1fe66b5cc962b0f469252b18d8a2f6f4'
         'dedc888d353e43539fa178d7e622fdc3'
         'c0f7e6a53fe1c508e0eb66316f64a580'
         '63230686ec34f855914afe9ffe799ed8'
         'dae3938c0cef49c77a4b4cc2c016ff81'
         '353926d8046acdbd21dac9458cbe2618'
         '882b9c4fc9520778cf7ce7999ef6873f')

prepare() {
  for i in ${pkgname[@]}; do
    _pkglang=${i#*-}
    _pkglang=${_pkglang/fresh-}

    echo ${_pkglang} " unpacking..."
    cd "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_${_pkglang}/RPMS

    # remove dictionaries if shipped - we ship them now in separate packages
    rm -vf *-dict-*.rpm || /bin/true

    for j in *.rpm
      do rpmextract.sh $j
    done

    # the helppack rpm goes also into the langpack dir
    rpmextract.sh \
      "${srcdir}"/LibreOffice_${_rcver}_Linux_x86_rpm_helppack_${_pkglang}/RPMS/*.rpm \
      || true
  done
}

_package() {
  pkgdesc="$2 language pack for LibreOffice Fresh"
  depends=('libreoffice-fresh')
  provides=("openoffice-$1" "libreoffice-$1")
  conflicts=("openoffice-$1" "libreoffice-$1")
  replaces=("openoffice-$1")

  cd "$srcdir"/LibreOffice_${_rcver}_Linux_x86_rpm_langpack_$1/RPMS
  mkdir -p "$pkgdir"/usr/lib/libreoffice
  cp -R opt/libreoffice*/* "$pkgdir"/usr/lib/libreoffice
  chown root:root -R "$pkgdir"/usr/lib/libreoffice
}

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=libreoffice-fresh-$_locale
  source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_langpack_${_locale}.tar.gz)

  if curl -o /dev/null -s -I -f ${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz; then
    source+=(${_url}/LibreOffice_${_oodlver}_Linux_x86_rpm_helppack_${_locale}.tar.gz)
  fi

  pkgname+=($_pkgname)
  eval "package_${_pkgname}() {
    _package $_lang
  }"
done
