From 999bdb0dafe6f65ea41a4faf24ef5062f3dd6bcc Mon Sep 17 00:00:00 2001
From: Johan Klokkhammer Helsing <johan.helsing@qt.io>
Date: Tue, 21 May 2019 09:06:30 +0200
Subject: [PATCH 1/1] Client: Don't crash when the cursor theme fails to load

Fixes: QTBUG-75920
Change-Id: I29d84b487afb2a90b8a633abce2fcc39ca75adae
---
 src/client/qwaylandinputdevice.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/client/qwaylandinputdevice.cpp b/src/client/qwaylandinputdevice.cpp
index 39c02d962..7f6f01cd1 100644
--- a/src/client/qwaylandinputdevice.cpp
+++ b/src/client/qwaylandinputdevice.cpp
@@ -272,6 +272,10 @@ void QWaylandInputDevice::Pointer::updateCursorTheme()
     int pixelSize = cursorSize() * scale;
     auto *display = seat()->mQDisplay;
     mCursor.theme = display->loadCursorTheme(cursorThemeName(), pixelSize);
+
+    if (!mCursor.theme)
+        return; // A warning has already been printed in loadCursorTheme
+
     if (auto *arrow = mCursor.theme->cursorImage(Qt::ArrowCursor)) {
         int arrowPixelSize = qMax(arrow->width, arrow->height); // Not all cursor themes are square
         while (scale > 1 && arrowPixelSize / scale < cursorSize())
@@ -310,6 +314,9 @@ void QWaylandInputDevice::Pointer::updateCursor()
     if (!mCursor.theme || idealCursorScale() != mCursor.themeBufferScale)
         updateCursorTheme();
 
+    if (!mCursor.theme)
+        return;
+
     // Set from shape using theme
     if (struct ::wl_cursor_image *image = mCursor.theme->cursorImage(shape)) {
         struct wl_buffer *buffer = wl_cursor_image_get_buffer(image);
-- 
2.16.3

