[Trigger]
Operation = Upgrade
Operation = Remove
Type = File
Target = usr/src/*/dkms.conf
Target = usr/lib/modules/*/
Target = !usr/lib/modules/extramodules-*
Target = !usr/lib/modules/*/?*

[Action]
Description = Remove DKMS modules
Depends = dkms
When = PreTransaction
# SIGPIPE workaround. See FS#49816
#Exec = /usr/lib/dkms/alpm-hook remove
Exec = /usr/bin/perl -e "$SIG{PIPE}='DEFAULT'; exec('/usr/lib/dkms/alpm-hook', 'remove');"
NeedsTargets
