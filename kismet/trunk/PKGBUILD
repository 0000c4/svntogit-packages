# $Id$
# Contributer: Jason Chu <jason@archlinux.org>
# Maintainer: Jason Chu <jason@archlinux.org>

pkgname=kismet
pkgver=2008_05_R1
_realver=2008-05-R1
pkgrel=3
pkgdesc="802.11b sniffing software"
arch=(i686 x86_64)
license=('GPL')
if [ "${CARCH}" == "x86_64" ]; then
  depends=('gcc-libs' 'libpcap>=1.0.0' 'ncurses' 'dbus')
else
  depends=('gmp' 'imagemagick' 'libpcap>=1.0.0' 'ncurses' 'dbus')
fi
url="http://www.kismetwireless.net/"
backup=('etc/ap_manuf' 'etc/client_manuf' 'etc/kismet.conf' 'etc/kismet_drone.conf' 'etc/kismet_ui.conf')
source=(http://www.kismetwireless.net/code/kismet-$_realver.tar.gz)
md5sums=('6ee365d36354b4dee4945e67f8149294')
sha1sums=('a1c682797ad6842b53f9e0f038254aa8326e0fb4'
          'dbb2aa1a99811a010b1fe9ddbc064b8b312d81d5')

build() {
   cd $startdir/src/kismet-$_realver
   # patch -Np1 -i ${srcdir}/kismet-gcc43.patch
   
   if [ $CARCH == "x86_64" ]; then
     ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
                 --disable-gpsmap
   else
     ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var
   fi
   make dep
   make ||return 1
   sed -i 's/prism2/wlanng/g' conf/kismet.conf
   make DESTDIR=$startdir/pkg install

   mkdir -p $startdir/pkg/usr/share/kismet
   install -m 644 $startdir/src/kismet-$_realver/README $startdir/pkg/usr/share/kismet

   # Fix the *.conf unexpanded ${prefix} problems
   sed -i 's%\${prefix}%/usr%' $startdir/pkg/etc/*.conf
}
