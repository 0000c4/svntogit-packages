# $Id$
# Contributor: <kleptophobiac@gmail.com>
# Contributor: dorphell <dorphell@archlinux.org>
# Maintainer: Juergen Hoetzel <juergen@archlinux.org>

pkgname=mythtv
pkgver=0.22
pkgrel=1
pkgdesc="A Homebrew PVR project"
arch=('i686' 'x86_64')
url="http://www.mythtv.org/"
license=('GPL2')
groups=('pvr')
depends=('bash' 'mysql-clients' 'qt' 'lame' 'lirc-utils' 'ffmpeg' \
	'libxvmc')
makedepends=(libgl)
backup=(etc/mythtv/mythbackend.conf etc/mythtv/mysql.txt)
install=mythtv.install
source=(ftp://ftp.osuosl.org/pub/mythtv/${pkgname}-${pkgver}.tar.bz2)
md5sums=('913c93028f557441de6908b749bc3d0c')

# 
build() {
   cd $srcdir/${pkgname}-${pkgver} 
   
   ARCH=${CARCH/_/-}
  ./configure --prefix=/usr --cpu=${ARCH} --enable-mmx --enable-audio-oss \
   --enable-audio-alsa --enable-dvb --enable-lirc --enable-joystick-menu \
   --disable-firewire --enable-v4l --enable-ivtv --enable-dvb \
   --dvb-path=/usr/include/linux/dvb --enable-xvmc --disable-ffmpeg \
   --enable-xvmc-pro --enable-xvmc-vld --enable-opengl-vsync \
   --disable-audio-jack --disable-audio-arts || return 1

   # build

   qmake mythtv.pro  
   make 

   # basic install
   make INSTALL_ROOT=$pkgdir install 
   
   # install db schema
   install -m0644 database/mc.sql $pkgdir/usr/share/mythtv/ 
   install -D -m0755 ../mythbackend $pkgdir/etc/rc.d/mythbackend 
   cp -r docs $pkgdir/usr/share/mythtv/ 

   # install contrib
   mkdir -p $pkgdir/usr/share/mythtv/contrib 
   install -m0755 contrib/* $pkgdir/usr/share/mythtv/contrib

   # set suid on mythfrontend
   chmod a+s $pkgdir/usr/bin/mythfrontend
}
