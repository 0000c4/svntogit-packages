# $Id$
# Maintainer: Paul Mattal <paul@archlinux.org>

pkgname=motion
pkgver=3.2.10.1
pkgrel=4
pkgdesc="Motion is a software motion detector. It grabs images from video4linux devices and/or from webcams."
arch=(i686 x86_64)
license=('GPL')
url="http://www.lavrsen.dk/twiki/bin/view/Motion/WebHome"
depends=('curl' 'ffmpeg>=20080625' 'libogg' 'libvorbis' 'lame' 'xvidcore' 'x264>=20080625' 'mjpegtools')
source=(http://dl.sf.net/sourceforge/motion/$pkgname-$pkgver.tar.gz rc.motion motion-3.2.10.1-ffmpegheaders.patch)
md5sums=('5ffdc958313345c69d3e0d5ec5c013cd' 'fc09828564850824f8549d258053e0b6'\
         '28bf5e6909fe73e41dde5f8f1101e6dd')

build() {
  cd $startdir/src/$pkgname-$pkgver || return 1

  patch -p1 < ../motion-3.2.10.1-ffmpegheaders.patch
  autoreconf
  ./configure --prefix=/usr --without-pgsql --without-mysql \
  	--with-libavcodec=/usr/lib/ --sysconfdir=/etc/$pkgname || return 1

  make || return 1

  make DESTDIR=$startdir/pkg install || return 1
  install -D -m755 $startdir/src/rc.motion $startdir/pkg/etc/rc.d/motion \
  	|| return 1
}
